-- Create default field mappings for checkout-pay-later email type
-- This migration populates the email_field_mappings table with essential mappings for boiler checkout-pay-later emails

-- Insert default field mappings for checkout-pay-later email type
INSERT INTO email_field_mappings (
  partner_id,
  service_category_id,
  email_type,
  template_field_name,
  database_source,
  database_path,
  template_type,
  html_template,
  html_template_type,
  loop_config,
  template_variables,
  integration_types,
  display_name,
  description,
  field_category,
  is_required,
  is_system,
  is_active,
  created_at,
  updated_at
) VALUES 
-- Contact Information
(
  '00000000-0000-0000-0000-000000000000', -- System default (will be overridden per partner)
  '00000000-0000-0000-0000-000000000000', -- System default (will be overridden per category)
  'checkout-pay-later',
  'customer_name',
  'checkout_data',
  '{"path": "user_contact_info.first_name"}',
  'format',
  NULL,
  'name',
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Customer Name',
  'Customer first name',
  'Contact',
  true,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'customer_full_name',
  'checkout_data',
  '{"path": "user_contact_info"}',
  'format',
  NULL,
  'full_name',
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Customer Full Name',
  'Customer full name (first + last)',
  'Contact',
  true,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'customer_email',
  'checkout_data',
  '{"path": "user_contact_info.email"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Customer Email',
  'Customer email address',
  'Contact',
  true,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'customer_phone',
  'checkout_data',
  '{"path": "user_contact_info.phone"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Customer Phone',
  'Customer phone number',
  'Contact',
  false,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'customer_postcode',
  'checkout_data',
  '{"path": "user_contact_info.postcode"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Customer Postcode',
  'Customer postcode',
  'Contact',
  false,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'customer_address',
  'checkout_data',
  '{"path": "user_contact_info.address"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Customer Address',
  'Customer full address',
  'Contact',
  false,
  true,
  true,
  NOW(),
  NOW()
),

-- Order Information
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'order_details',
  'checkout_data',
  '{"path": "booking_data"}',
  'html_template',
  '<div class="order-summary">
    <h3>Order Summary</h3>
    <p><strong>Total Amount:</strong> £{{booking_data.total_amount}}</p>
    <p><strong>Deposit Amount:</strong> £{{booking_data.deposit_amount}}</p>
    <p><strong>Payment Method:</strong> Pay After Installation</p>
    {{#if booking_data.booking_notes}}
    <p><strong>Notes:</strong> {{booking_data.booking_notes}}</p>
    {{/if}}
    {{#if booking_data.special_requirements}}
    <p><strong>Special Requirements:</strong> {{booking_data.special_requirements}}</p>
    {{/if}}
  </div>',
  'order_summary',
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Order Details',
  'Formatted order summary with payment after installation details',
  'Order',
  true,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'payment_info',
  'checkout_data',
  '{"path": "booking_data"}',
  'html_template',
  '<div class="payment-info">
    <h3>Payment Information</h3>
    <p><strong>Payment Method:</strong> Pay After Installation</p>
    <p><strong>Total Amount:</strong> £{{booking_data.total_amount}}</p>
    <p><strong>Deposit Amount:</strong> £{{booking_data.deposit_amount}}</p>
    <p><strong>Status:</strong> Booking Confirmed - Payment Due After Installation</p>
    {{#if booking_data.finance_terms}}
    <p><strong>Finance Terms:</strong> {{booking_data.finance_terms}}</p>
    {{/if}}
  </div>',
  'payment_plan',
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Payment Information',
  'Payment details for pay after installation',
  'Payment',
  true,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'installation_info',
  'checkout_data',
  '{"path": "booking_data.preferred_installation_date"}',
  'format',
  NULL,
  'date',
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Installation Information',
  'Preferred installation date',
  'Installation',
  false,
  true,
  true,
  NOW(),
  NOW()
),

-- Submission Information
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'submission_id',
  'checkout_data',
  '{"path": "submission_id"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Submission ID',
  'Unique submission identifier',
  'System',
  true,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'submission_date',
  'checkout_data',
  '{"path": "booking_data.booking_submitted_at"}',
  'format',
  NULL,
  'date',
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Submission Date',
  'Date and time of submission',
  'System',
  true,
  true,
  true,
  NOW(),
  NOW()
),

-- Calculator Settings
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'calculator_settings',
  'checkout_data',
  '{"path": "calculator_settings"}',
  'html_template',
  '<div class="calculator-settings">
    <h3>Finance Calculator Settings</h3>
    {{#if calculator_settings.selected_plan}}
    <p><strong>Selected Plan:</strong> {{calculator_settings.selected_plan.months}} months at {{calculator_settings.selected_plan.apr}}% APR</p>
    {{/if}}
    {{#if calculator_settings.selected_deposit}}
    <p><strong>Selected Deposit:</strong> £{{calculator_settings.selected_deposit}}</p>
    {{/if}}
  </div>',
  'custom',
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Calculator Settings',
  'Finance calculator settings and terms',
  'Finance',
  false,
  true,
  true,
  NOW(),
  NOW()
),

-- Partner Information (from partner profile)
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'company_name',
  'partner_info',
  '{"path": "company_name"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Company Name',
  'Partner company name',
  'Company',
  true,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'company_phone',
  'partner_info',
  '{"path": "phone"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Company Phone',
  'Partner company phone number',
  'Company',
  false,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'company_address',
  'partner_info',
  '{"path": "address"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Company Address',
  'Partner company address',
  'Company',
  false,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'company_website',
  'partner_info',
  '{"path": "website_url"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Company Website',
  'Partner company website URL',
  'Company',
  false,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'company_logo',
  'partner_info',
  '{"path": "logo_url"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Company Logo',
  'Partner company logo URL',
  'Company',
  false,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'company_color',
  'partner_info',
  '{"path": "company_color"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Company Color',
  'Partner company brand color',
  'Company',
  false,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'privacy_policy',
  'partner_info',
  '{"path": "privacy_policy"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Privacy Policy',
  'Partner privacy policy URL',
  'Company',
  false,
  true,
  true,
  NOW(),
  NOW()
),
(
  '00000000-0000-0000-0000-000000000000',
  '00000000-0000-0000-0000-000000000000',
  'checkout-pay-later',
  'terms_conditions',
  'partner_info',
  '{"path": "terms_conditions"}',
  'simple',
  NULL,
  NULL,
  '{}',
  '{}',
  '["email", "ghl", "webhook"]',
  'Terms & Conditions',
  'Partner terms and conditions URL',
  'Company',
  false,
  true,
  true,
  NOW(),
  NOW()
);

-- Create indexes for performance
CREATE INDEX IF NOT EXISTS email_field_mappings_checkout_pay_later_idx 
ON email_field_mappings(partner_id, service_category_id, email_type) 
WHERE email_type = 'checkout-pay-later' AND is_active = true;
